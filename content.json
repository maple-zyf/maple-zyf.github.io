{"meta":{"title":"Zeyife's blog","subtitle":"some notes might be helpful to you.","description":"I don't even have a pla~.","author":"Zeyife","url":"http://maple-zyf.github.io"},"pages":[{"title":"tags","date":"2016-07-06T03:55:51.000Z","updated":"2016-07-06T03:57:08.000Z","comments":false,"path":"tags/index.html","permalink":"http://maple-zyf.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"","slug":"touchpadDisable-Note","date":"2016-07-07T10:26:38.117Z","updated":"2016-07-07T06:22:53.000Z","comments":true,"path":"2016/07/07/touchpadDisable-Note/","link":"","permalink":"http://maple-zyf.github.io/2016/07/07/touchpadDisable-Note/","excerpt":"","text":"用外接鼠标的插拨来自动禁启用触摸板 /* @licstart The following is the entire license notice for the JavaScript code in this tag. Copyright (C) 2012-2013 Free Software Foundation, Inc. The JavaScript code in this tag is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License (GNU GPL) as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. The code is distributed WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU GPL for more details. As additional permission under GNU GPL version 3 section 7, you may distribute non-source (e.g., minimized or compacted) forms of that code without the copy of the GNU GPL normally required by section 4, provided you include this license notice and a URL through which recipients can access the Corresponding Source. @licend The above is the entire license notice for the JavaScript code in this tag. */ 用外接鼠标的插拨来自动禁启用触摸板 Table of Contents 1. TouchPad Problems 2. Conception 3. Hacking TouchPad En/Disable with Mouse 3.1. gdm登陆页面 3.2. gnome3桌面 3.3. 用鼠标插拨事件来禁/启用触摸板 3.4. 系统从休眠中唤醒时刷新触摸板状态 4. Done ! 1 TouchPad Problems debian下每次开机触摸板都是默认开启的，虽然可以设置\"disable while typing\" 但是总有误触的情况，xinput可以在软件层拦截事件来禁用触摸板．为了方便google到了 一个可以根据外接鼠标插拨事件来自动控制触摸板的方法．我的桌面环境为debian8, gnome3. 2 Conception 先查看输入设备： bogwon@bogwon-desktop ~ $ xinput -list ⎡ Virtual core pointer id=2 [master pointer (3)] ⎜ ↳ Virtual core XTEST pointer id=4 [slave pointer (2)] ⎜ ↳ USB Optical Mouse id=14 [slave pointer (2)] ⎣ Virtual core keyboard id=3 [master keyboard (2)] ↳ Virtual core XTEST keyboard id=5 [slave keyboard (3)] 可以看出电脑的pointer(鼠标)有两个： Virtual core XTEST pointer id=2 USB Optical Mouse id=14 这个 USB Optical Mouse 就是外接鼠标啦, 我们要找的自然就是 Virtual core XTEST poin 他的 id=4 . 现在用xinput list-props来看它的详细信息. =可以用名字，也可以用id= bogwon@bogwon-desktop ~ $ xinput list-props 4 Device 'ETPS/2 Elantech Touchpad': Device Enabled (135): 1 Coordinate Transformation Matrix (137): 1.000000, 0.000000, ... ... 注意看 Device Enabled (135): 1 表示触摸板是被启用的 试试禁用它： //这两条命令是一个意思 bogwon@bogwon-desktop ~ $ xinput set-prop 4 'Device Enabled' 0 #通过设备编号+属性名禁用触摸板 bogwon@bogwon-desktop ~ $ xinput set-prop 4 135 0 #通过设备编号+属性编号来设置 //查看现在的状态 bogwon@bogwon-desktop ~ $ xinput list-props 4 Device 'ETPS/2 Elantech Touchpad': Device Enabled (135): 0 #变成了0，表示禁用 Coordinate Transformation Matrix (137): 1.000000, 0.000000, ... ... 现在你的触摸板是不是已经不能用了. ^O^ 3 Hacking TouchPad En/Disable with Mouse 要让触摸板在任何时候都受鼠标控制，有三个方面需要考虑． 所有测试都是一个外接鼠标的情况,穷屌丝只有一个鼠标额 3.1 gdm登陆页面 开机后(进入gdm登陆界面时)根据是否有外接鼠标来控制一次触摸板状态． 方法是把下面部分代码添加到 /etc/gdm/Init/Default 的 'exit 0' 之前． #disable touchpad if more than one mouse is available if [ `ls -d /sys/class/input/mouse* | wc -l` -gt 1 ]; then /usr/bin/xinput --set-prop ETPS/2\\ Elantech\\ Touchpad Device\\ Enabled 0 fi 这一句要注意：if [ `ls -d /sys/class/input/mouse* | wc -l` -gt 1 ]; then 懂点shell-script的就能看懂了，ls 列出了系统中的mouse; wc -l是数行数. 也就是 if [ 行数(鼠标数) great than 1 ]; then 3.2 gnome3桌面 由gmd进入gnome3后发现触摸板居然又能用了，这个时的解决方法是用autostart自启动项． 先创建~/disableTouchpad.sh 内容如下: #!/bin/bash if [ `ls -d /sys/class/input/mouse* | wc -l` -gt 1 ]; then /usr/bin/xinput --set-prop 'ETPS/2 Elantech Touchpad' 'Device Enabled' 0 fi 再在~/.config/autostart/下创建一个启动器disableTouchpad.desktop文件，内容如下 [Desktop Entry] Type=Application Exec=/path/to/disableTouchpad.sh Hidden=yes NoDisplay=yes X-GNOME-Autostart-enabled=true Name[zh_CN]=touchpad disable Name=touchpad disable Comment[zh_CN]=禁用触摸板 Comment=禁用触摸板 3.3 用鼠标插拨事件来禁/启用触摸板 在系统规则中为触摸板添加一条规则命名为 /etc/udev/rules.d/61-touchpad.rules # 61-touchpad.rules # disable PS/2 touchpad on DISPLAY :0 if a mouse is added to the system ACTION==\"add\", SUBSYSTEM==\"input\", ENV{ID_INPUT_MOUSE}==\"1\", \\ RUN+=\"/bin/sh -c 'DISPLAY=:0 /usr/bin/xinput --set-prop \\ ETPS/2\\ Elantech\\ Touchpad Device\\ Enabled 0'\" # enable PS/2 touchpad on DISPLAY :0 if a mouse is removed from the system ACTION==\"remove\", SUBSYSTEM==\"input\", ENV{ID_INPUT_MOUSE}==\"1\", \\ RUN+=\"/bin/sh -c 'DISPLAY=:0 /usr/bin/xinput --set-prop \\ ETPS/2\\ Elantech\\ Touchpad Device\\ Enabled 1'\" 这个脚本定义了两个action, 分别在外接鼠标\"add\"和＂remove\"时，执行RUN参数后xinput 命令来管理触摸板．想了解更多可以看rules.d的官方文档． 3.4 系统从休眠中唤醒时刷新触摸板状态 将下面部分代码保存为 /etc/pm/sleep.d/99touchpad #!/bin/sh # disable touchpad if more than one mouse is available disable_touchpad() { /bin/sh -c 'DISPLAY=:0 /usr/bin/xinput --set-prop PS/2\\ Generic\\ TouchPad Device\\ Enabled 0' } case \"$1\" in thaw|resume) if [ `ls -d /sys/class/input/mouse* | wc -l` -gt 1 ]; then disable_touchpad fi ;; *) exit $NA ;; esac 4 Done ! 现在都搞定了，重启试试看看有没有什么bug吧． Date: &lt;2016-07-07 Thu&gt; Author: maple Created: 2016-07-07 Thu 14:22 Validate","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2016-07-07T10:26:38.111Z","updated":"2016-07-06T03:39:02.000Z","comments":true,"path":"2016/07/07/hello-world/","link":"","permalink":"http://maple-zyf.github.io/2016/07/07/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}